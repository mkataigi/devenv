---
name: split-commit
description: Gitの変更差分を分析し、論理的な内容ごとにグループ化して適切な単位で分割コミットを作成します。「変更を分割してコミット」「差分を整理してコミット」「スマートコミット」などのリクエストに対して使用してください。
disable-model-invocation: true
user-invocable: true
allowed-tools: Bash, Read, Glob, Grep
---

# Split Commit Skill

Gitの変更差分を分析し、論理的な変更単位ごとに分割して1つまたは複数のコミットを作成します。

**重要**: コミットメッセージはすべて日本語で記述してください。

## 実行手順

### Step 1: 変更差分の収集

以下のコマンドで現在の変更状態を把握します。

```bash
# ステージ済み・未ステージの変更ファイル一覧
git status --short

# 未ステージの変更内容
git diff

# ステージ済みの変更内容
git diff --cached

# 直近のコミットログ（スタイル参考用）
git log --oneline -10
```

変更がない場合は「コミット対象の変更がありません」と報告して終了してください。

### Step 2: 変更内容の分析とグループ化

収集した差分を以下の基準で論理グループに分類してください。

#### 分類の優先順位

1. **機能単位**: 同一の機能追加・修正に関わるファイル群（実装コード + テスト + 設定等）
2. **変更の種類**: 新機能 / バグ修正 / リファクタリング / ドキュメント / 設定変更 / 依存関係更新
3. **影響範囲**: 同一モジュール・コンポーネント・レイヤーに属する変更

#### グループ化のルール

- 1つの機能に関する実装コードとそのテストは同じグループにする
- 無関係な機能の変更は別グループにする
- リファクタリングと機能追加が混在する場合は分離する
- 設定ファイルのみの変更は独立したグループにする
- ドキュメントのみの変更は独立したグループにする
- 依存関係の追加・更新は独立したグループにする
- 1ファイル内に複数の論理的変更がある場合はhunkレベルでの分割（`git add -p`）を検討する

### Step 3: 分割計画の提示と承認

分析結果をユーザーに提示してください。以下の形式で表示します。

```
## 変更差分の分析結果

### グループ1: [変更の概要]
- 種類: feat / fix / refactor / docs / chore 等
- 対象ファイル:
  - path/to/file1.ts (変更内容の要約)
  - path/to/file2.ts (変更内容の要約)
- コミットメッセージ案: ✨ feat: ○○機能を追加

### グループ2: [変更の概要]
- 種類: ...
- 対象ファイル:
  - ...
- コミットメッセージ案: 🐛 fix: △△の不具合を修正

(グループが1つの場合は分割不要の旨を伝える)
```

提示後、ユーザーの承認を得てからコミットを実行してください。
ユーザーがグループの変更や統合・さらなる分割を希望した場合は調整してください。

### Step 4: コミットの実行

承認を得たら、以下の手順でグループごとにコミットを作成します。

#### 通常のファイル単位の分割

```bash
# まず全てのステージをクリア
git reset HEAD

# グループ1のファイルをステージしてコミット
git add path/to/file1.ts path/to/file2.ts
git commit -m "$(cat <<'EOF'
✨ feat: ○○機能を追加

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
EOF
)"

# グループ2のファイルをステージしてコミット
git add path/to/file3.ts
git commit -m "$(cat <<'EOF'
🐛 fix: △△の不具合を修正

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
EOF
)"
```

#### 同一ファイル内の分割が必要な場合

1つのファイルに複数の論理的変更が含まれる場合、`git add -p` による対話的ステージングが必要です。
この場合、ユーザーに手動操作が必要である旨を伝え、具体的な手順を案内してください。

```
以下のファイルは1ファイル内に複数の論理的変更が含まれています:
- path/to/mixed_file.ts

手動で `git add -p path/to/mixed_file.ts` を実行し、
グループ1に該当するhunkのみをステージしてください。
ステージ完了後、このスキルを再度呼び出してコミットを続行できます。
```

### Step 5: 結果の報告

全てのコミットが完了したら、以下の形式で報告してください。

```
## コミット完了

### 作成したコミット
1. abc1234 ✨ feat: ○○機能を追加 (3 files changed)
2. def5678 🐛 fix: △△の不具合を修正 (1 file changed)

### 合計
- コミット数: 2
- 変更ファイル数: 4
```

## コミットメッセージの規約

### 形式

```
<emoji> <type>: <日本語の簡潔な説明>
```

- 1行目は72文字以内
- 本文が必要な場合は空行を挟んで記述

### Type と Emoji の対応

| Emoji | Type | 用途 |
|-------|------|------|
| ✨ | feat | 新機能 |
| 🐛 | fix | バグ修正 |
| 📝 | docs | ドキュメント |
| 💄 | style | フォーマット/スタイル |
| ♻️ | refactor | リファクタリング |
| ⚡️ | perf | パフォーマンス改善 |
| ✅ | test | テスト |
| 🔧 | chore | ツール、設定 |
| 🚀 | ci | CI/CD |
| ➕ | chore | 依存関係の追加 |
| ➖ | chore | 依存関係の削除 |
| 🔥 | fix | コード・ファイルの削除 |
| ✏️ | fix | タイポ修正 |
| 🚚 | refactor | ファイルの移動・リネーム |

## 重要な注意事項

- コミット前に必ず `git diff --cached` でステージ内容を確認し、意図しないファイルが含まれていないか検証する
- `.env`、認証情報、秘密鍵などの機密ファイルが含まれていないか確認する
- コミットの順序は依存関係を考慮する（例: 新しいユーティリティを追加→それを使う機能を追加）
- 各コミット単体でビルド・テストが通る状態を維持する（壊れた中間状態を作らない）
- `git add -A` や `git add .` は使用しない。必ずファイルを明示的に指定する
